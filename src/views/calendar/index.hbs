<div class="container mx-auto px-4 py-8"> <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4"> <h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3"> <i class="fas fa-calendar-alt text-blue-500"></i> Calendario de Riego </h1> <!-- Selector de Semanas --> <div class="flex items-center gap-2 bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700"> <label for="semanaSelector" class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap"> <i class="fas fa-filter mr-1"></i> Filtrar por: </label> <select id="semanaSelector" class="form-select block w-full pl-3 pr-10 py-1 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:border-gray-600 dark:text-white"> <option value="">Todas las semanas</option> {{#each semanas}} <option value="{{this.id}}">{{this.nombre}}</option> {{/each}} </select> </div> </div> <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700 max-w-4xl mx-auto"> <div id='calendar'></div> </div> </div>

{{{scripts}}}
<script> document.addEventListener('DOMContentLoaded', function() { var calendarEl = document.getElementById('calendar'); var calendar = new FullCalendar.Calendar(calendarEl, { initialView: 'dayGridMonth', height: 550, locale: 'es', headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay,multiMonthYear' }, buttonText: { today: 'Hoy', month: 'Mes', week: 'Semana', day: 'DÃ­a', year: 'AÃ±o' }, navLinks: true, // permite hacer clic en los nombres de dÃ­a/semana para navegar editable: false, dayMaxEvents: true, // permitir enlace "mÃ¡s" cuando hay demasiados eventos events: '/calendar/events', // Cargar eventos desde la API eventDidMount: function(info) { // Agregar tooltip o descripciÃ³n si es necesario if (info.event.extendedProps.description) { info.el.title = info.event.extendedProps.description; } } }); calendar.render(); // Manejar cambio de semana const semanaSelector = document.getElementById('semanaSelector'); semanaSelector.addEventListener('change', function() { const semanaId = this.value; const newSource = { url: '/calendar/events', extraParams: semanaId ? { semana_id: semanaId } : {} }; // Eliminar fuentes anteriores y agregar la nueva con el filtro const oldSource = calendar.getEventSources()[0]; if (oldSource) { oldSource.remove(); } calendar.addEventSource(newSource); }); // Observador para redibujar el calendario si cambia el tema (para ajustar colores si es necesario) const observer = new MutationObserver((mutations) => { mutations.forEach((mutation) => { if (mutation.attributeName === 'class') { calendar.render(); // Forzar redibujado } }); }); observer.observe(document.documentElement, { attributes: true }); }); </script>