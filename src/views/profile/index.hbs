<div class="container mx-auto px-4 py-4 md:py-8 max-w-6xl"> <!-- Header --> <div class="mb-6 md:mb-8"> <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-2 md:gap-3"> <i class="fas fa-user-circle text-green-500 text-xl md:text-2xl"></i> Mi Perfil </h1> <p class="text-sm md:text-base text-gray-600 dark:text-gray-400 mt-1 md:mt-2">Gestiona tu informaciÃ³n personal y configuraciÃ³n de cuenta</p> </div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6"> <!-- Sidebar --> <div class="lg:col-span-1"> <!-- Profile Card --> <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700 text-center"> <!-- Avatar con opciones --> <div class="relative inline-block mb-3 md:mb-4 group"> <div class="w-20 h-20 md:w-24 md:h-24 rounded-full overflow-hidden shadow-lg border-4 border-white dark:border-gray-700"> {{#if user.avatar}} <img id="avatarImage" src="{{user.avatar}}" alt="Avatar" class="w-full h-full object-cover"> {{else}} <div id="avatarPlaceholder" class="w-full h-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center"> <i class="fas fa-user text-3xl md:text-4xl text-white"></i> </div> {{/if}} </div> <!-- Overlay con opciones (aparece al hacer hover) --> <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center gap-2"> <label for="avatarInput" class="bg-green-500 hover:bg-green-600 text-white rounded-full w-10 h-10 flex items-center justify-center cursor-pointer shadow-lg transition-colors" title="Cambiar foto"> <i class="fas fa-camera text-sm"></i> </label> {{#if user.avatar}} <button id="deleteAvatarBtn" class="bg-red-500 hover:bg-red-600 text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg transition-colors" title="Eliminar foto"> <i class="fas fa-trash-alt text-sm"></i> </button> {{/if}} </div> <input type="file" id="avatarInput" accept="image/*" class="hidden"> </div> <h2 class="text-lg md:text-xl font-bold text-gray-900 dark:text-white break-words">{{user.nombre}}</h2> <p class="text-gray-500 dark:text-gray-400 text-xs md:text-sm mt-1 break-all">{{user.email}}</p> <div class="mt-3 md:mt-4 inline-flex items-center px-2.5 md:px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"> <i class="fas fa-shield-alt mr-1 text-xs"></i> {{user.rol}} </div> </div> <!-- Stats Card --> <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700 mt-4 md:mt-6"> <h3 class="text-base md:text-lg font-bold text-gray-900 dark:text-white mb-3 md:mb-4 flex items-center gap-2"> <i class="fas fa-chart-bar text-blue-500 text-sm md:text-base"></i> EstadÃ­sticas </h3> <div class="space-y-3 md:space-y-4"> <div class="flex justify-between items-center"> <span class="text-gray-600 dark:text-gray-400 text-xs md:text-sm flex items-center gap-2"> <i class="fas fa-microchip w-4 md:w-5 text-center text-xs md:text-sm"></i> Dispositivos </span> <span class="text-lg md:text-xl font-bold text-gray-900 dark:text-white">{{stats.total_dispositivos}}</span> </div> <div class="flex justify-between items-center"> <span class="text-gray-600 dark:text-gray-400 text-xs md:text-sm flex items-center gap-2"> <i class="fas fa-thermometer-half w-4 md:w-5 text-center text-xs md:text-sm"></i> Sensores </span> <span class="text-lg md:text-xl font-bold text-gray-900 dark:text-white">{{stats.total_sensores}}</span> </div> <div class="flex justify-between items-center"> <span class="text-gray-600 dark:text-gray-400 text-xs md:text-sm flex items-center gap-2"> <i class="fas fa-database w-4 md:w-5 text-center text-xs md:text-sm"></i> Lecturas </span> <span class="text-lg md:text-xl font-bold text-gray-900 dark:text-white">{{stats.total_lecturas}}</span> </div> <div class="pt-3 md:pt-4 border-t border-gray-200 dark:border-gray-700"> <span class="text-gray-600 dark:text-gray-400 text-xs flex items-center gap-2"> <i class="fas fa-calendar-alt text-xs"></i> Miembro desde </span> <span class="text-xs md:text-sm font-medium text-gray-900 dark:text-white mt-1 block">{{formatDate stats.fecha_registro}}</span> </div> </div> </div> </div> <!-- Main Content --> <div class="lg:col-span-2 space-y-4 md:space-y-6"> <!-- Edit Profile --> <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700"> <h3 class="text-base md:text-lg font-bold text-gray-900 dark:text-white mb-3 md:mb-4 flex items-center gap-2"> <i class="fas fa-user-edit text-green-500 text-sm md:text-base"></i> InformaciÃ³n Personal </h3> <form id="profileForm" class="space-y-3 md:space-y-4"> <div> <label for="nombre" class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> Nombre completo </label> <input type="text" id="nombre" name="nombre" value="{{user.nombre}}" required class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm md:text-base py-2 px-3"> </div> <div> <label for="email" class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> Correo electrÃ³nico </label> <input type="email" id="email" name="email" value="{{user.email}}" required class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm md:text-base py-2 px-3"> </div> <div id="profileMessage" class="hidden"></div> <div class="flex flex-col sm:flex-row gap-2 md:gap-3 pt-2"> <button type="submit" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white px-4 md:px-6 py-2 md:py-2.5 rounded-lg text-xs md:text-sm font-medium transition-colors shadow-sm flex items-center justify-center gap-2"> <i class="fas fa-save text-xs md:text-sm"></i> Guardar Cambios </button> <a href="/dashboard" class="w-full sm:w-auto bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 md:px-6 py-2 md:py-2.5 rounded-lg text-xs md:text-sm font-medium transition-colors shadow-sm flex items-center justify-center gap-2"> <i class="fas fa-times text-xs md:text-sm"></i> Cancelar </a> </div> </form> </div> <!-- Change Password --> <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700"> <h3 class="text-base md:text-lg font-bold text-gray-900 dark:text-white mb-3 md:mb-4 flex items-center gap-2"> <i class="fas fa-lock text-yellow-500 text-sm md:text-base"></i> Cambiar ContraseÃ±a </h3> <form id="passwordForm" class="space-y-3 md:space-y-4"> <div> <label for="currentPassword" class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> ContraseÃ±a actual </label> <input type="password" id="currentPassword" name="currentPassword" required class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm md:text-base py-2 px-3"> </div> <div> <label for="newPassword" class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> Nueva contraseÃ±a </label> <input type="password" id="newPassword" name="newPassword" required minlength="6" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm md:text-base py-2 px-3"> <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">MÃ­nimo 6 caracteres</p> </div> <div> <label for="confirmPassword" class="block text-xs md:text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> Confirmar contraseÃ±a </label> <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 text-sm md:text-base py-2 px-3"> </div> <div id="passwordMessage" class="hidden"></div> <button type="submit" class="w-full sm:w-auto bg-yellow-500 hover:bg-yellow-600 text-white px-4 md:px-6 py-2 md:py-2.5 rounded-lg text-xs md:text-sm font-medium transition-colors shadow-sm flex items-center justify-center gap-2"> <i class="fas fa-key text-xs md:text-sm"></i> Actualizar ContraseÃ±a </button> </form> </div> <!-- Account Info --> <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-3 md:p-4"> <div class="flex items-start gap-2 md:gap-3"> <i class="fas fa-info-circle text-blue-500 mt-0.5 md:mt-1 text-sm md:text-base"></i> <div class="text-xs md:text-sm text-blue-800 dark:text-blue-300"> <p class="font-medium mb-1">InformaciÃ³n de seguridad</p> <p>Tu informaciÃ³n estÃ¡ protegida y encriptada. Nunca compartas tu contraseÃ±a con nadie.</p> </div> </div> </div> </div> </div> </div>

{{{scripts}}}
<script> // Actualizar perfil document.getElementById('profileForm').addEventListener('submit', async (e) => { e.preventDefault(); const formData = { nombre: document.getElementById('nombre').value, email: document.getElementById('email').value }; const messageDiv = document.getElementById('profileMessage'); messageDiv.classList.add('hidden'); try { const response = await fetch('/profile/update', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) }); const data = await response.json(); if (data.success) { messageDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative'; messageDiv.textContent = data.message; messageDiv.classList.remove('hidden'); setTimeout(() => location.reload(), 1500); } else { messageDiv.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative'; messageDiv.textContent = data.message; messageDiv.classList.remove('hidden'); } } catch (error) { messageDiv.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative'; messageDiv.textContent = 'Error al actualizar perfil'; messageDiv.classList.remove('hidden'); } }); // Cambiar contraseÃ±a document.getElementById('passwordForm').addEventListener('submit', async (e) => { e.preventDefault(); const formData = { currentPassword: document.getElementById('currentPassword').value, newPassword: document.getElementById('newPassword').value, confirmPassword: document.getElementById('confirmPassword').value }; const messageDiv = document.getElementById('passwordMessage'); messageDiv.classList.add('hidden'); try { const response = await fetch('/profile/change-password', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) }); const data = await response.json(); if (data.success) { messageDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative'; messageDiv.textContent = data.message; messageDiv.classList.remove('hidden'); document.getElementById('passwordForm').reset(); } else { messageDiv.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative'; messageDiv.textContent = data.message; messageDiv.classList.remove('hidden'); } } catch (error) { messageDiv.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative'; messageDiv.textContent = 'Error al cambiar contraseÃ±a'; messageDiv.classList.remove('hidden'); } }); // Subir avatar document.getElementById('avatarInput').addEventListener('change', async (e) => { const file = e.target.files[0]; if (!file) return; // Validar tamaÃ±o (5MB mÃ¡ximo) if (file.size > 5 * 1024 * 1024) { alert('El archivo es demasiado grande. MÃ¡ximo 5MB.'); return; } // Validar tipo if (!file.type.startsWith('image/')) { alert('Solo se permiten archivos de imagen.'); return; } const formData = new FormData(); formData.append('avatar', file); try { const response = await fetch('/profile/upload-avatar', { method: 'POST', body: formData }); const data = await response.json(); if (data.success) { // Recargar pÃ¡gina para actualizar avatar en todas las vistas (navbar incluido) location.reload(); } else { alert(data.message); } } catch (error) { alert('Error al subir la foto de perfil'); } }); // Eliminar avatar function setupDeleteButton() { const deleteBtn = document.getElementById('deleteAvatarBtn'); if (deleteBtn) { deleteBtn.addEventListener('click', async () => { if (!confirm('Â¿EstÃ¡s seguro de eliminar tu foto de perfil?')) return; try { const response = await fetch('/profile/delete-avatar', { method: 'DELETE' }); const data = await response.json(); if (data.success) { alert(data.message); location.reload(); } else { alert(data.message); } } catch (error) { alert('Error al eliminar la foto de perfil'); } }); } } setupDeleteButton(); </script>