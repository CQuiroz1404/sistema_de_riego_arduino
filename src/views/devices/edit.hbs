<div class="container mx-auto px-4 py-8"> <div class="flex justify-between items-center mb-8"> <div> <h1 class="text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3"> <i class="fas fa-edit text-blue-500"></i> Editar Dispositivo </h1> <p class="text-gray-600 dark:text-gray-400 mt-1">{{device.nombre}}</p> </div> <a href="/devices/{{device.id}}" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2"> <i class="fas fa-arrow-left"></i> Volver </a> </div> <div class="max-w-3xl mx-auto"> <form id="editForm" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-8 border border-gray-100 dark:border-gray-700"> <div class="space-y-6"> <div> <label for="nombre" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> <i class="fas fa-microchip mr-1"></i> Nombre del Dispositivo * </label> <input type="text" id="nombre" name="nombre" required value="{{device.nombre}}" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm py-2 px-3"> </div> <div> <label for="invernadero_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> <i class="fas fa-home mr-1"></i> Invernadero </label> <select id="invernadero_id" name="invernadero_id" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm py-2 px-3"> <option value="">Seleccionar invernadero...</option> {{#each invernaderos}} <option value="{{this.id}}" {{#if (eq ../device.invernadero_id this.id)}}selected{{/if}}>{{this.descripcion}}{{#if this.ubicacion}} - {{this.ubicacion}}{{/if}}</option> {{/each}} </select> </div> <div> <label for="descripcion" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> <i class="fas fa-comment mr-1"></i> DescripciÃ³n </label> <textarea id="descripcion" name="descripcion" rows="3" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm py-2 px-3">{{device.descripcion}}</textarea> </div> <div> <label for="estado" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"> <i class="fas fa-power-off mr-1"></i> Estado </label> <select id="estado" name="estado" class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm focus:border-green-500 focus:ring-green-500 sm:text-sm py-2 px-3"> <option value="activo" {{#if (eq device.estado 'activo')}}selected{{/if}}>Activo</option> <option value="inactivo" {{#if (eq device.estado 'inactivo')}}selected{{/if}}>Inactivo</option> <option value="mantenimiento" {{#if (eq device.estado 'mantenimiento')}}selected{{/if}}>Mantenimiento</option> </select> </div> </div> <div id="errorMessage" class="mt-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative hidden" role="alert"></div> <div id="successMessage" class="mt-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative hidden" role="alert"></div> <div class="mt-8 flex gap-4"> <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2.5 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2"> <i class="fas fa-save"></i> Guardar Cambios </button> <a href="/devices/{{device.id}}" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 px-6 py-2.5 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2"> <i class="fas fa-times"></i> Cancelar </a> </div> </form> </div> </div>

{{{scripts}}}
<script> document.getElementById('editForm').addEventListener('submit', async (e) => { e.preventDefault(); const formData = { nombre: document.getElementById('nombre').value, invernadero_id: document.getElementById('invernadero_id').value, descripcion: document.getElementById('descripcion').value, estado: document.getElementById('estado').value }; const errorDiv = document.getElementById('errorMessage'); const successDiv = document.getElementById('successMessage'); errorDiv.classList.add('hidden'); successDiv.classList.add('hidden'); try { const response = await fetch('/devices/{{device.id}}', { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) }); const data = await response.json(); if (data.success) { successDiv.textContent = 'Dispositivo actualizado correctamente'; successDiv.classList.remove('hidden'); setTimeout(() => { window.location.href = '/devices/{{device.id}}'; }, 1500); } else { errorDiv.textContent = data.message; errorDiv.classList.remove('hidden'); } } catch (error) { errorDiv.textContent = 'Error al actualizar dispositivo'; errorDiv.classList.remove('hidden'); } }); </script>